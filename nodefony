#!/usr/local/bin/node

var cluster = require('cluster');	
var domain = require('domain');
var asciify = require('asciify');



//  AUTOLOAD LIBRARY nodefony NODE
var autoloader = require("./vendors/nodefony/core/autoloader");
autoloader.load("./app/appKernel.js");




if (cluster.isMaster) {

	asciify("      NODEFONY", {font:'standard'}, function(err, res){
		console.log('\033[31m'+res+'\033[0m');
	});

	var nbProc = require('os').cpus().length; 
	//var nbProc = 1; 
	for (var i=0 ; i<nbProc;i++){
		cluster.fork();
	}

	cluster.on('disconnect', function(worker) {
		console.error('disconnect!');
		//cluster.fork();
	});

	/*var logStream = new nodefony.log(process.cwd()+'/tmp/error.log',{
		rotate:true
	});
	var logStreamD = new nodefony.log(process.cwd()+'/tmp/debug.log',{
		rotate:true
	});*/
	
}else {
	var kernel =new nodefony.appKernel("SERVER", "prod", false, autoloader);
}








